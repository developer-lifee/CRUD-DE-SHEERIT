<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./styles.css">
    <title>Facturaci√≥n Compra</title>

</head>

   <body>
    <div class="banner">
        <br>
        <a href="#" class="button">Sheer It</a>
        <form action="../controllers/condicionesExcel.php" method="post" enctype="multipart/form-data">
          <input type="file" name="csv_file">
          <input type="submit" value="Cargar">
        </form>
      </div>
    <div class="banner">
        <a href="../controllers/cargaExcel.php" class="button">Sheer It</a>
    </div>

<table>
    <thead>
        <tr>
            <th>
                <div class="header-cell">
                    Correo
                    <span class="search-icon" onclick="toggleSearch(this)">üîç</span>
                    <input type="text" class="search-input" onkeyup="filtrarTabla(0, this.value)" placeholder="Buscar Correo">
                </div>
            </th>
            <th>
                <div class="header-cell">
                    Clave
                    <span class="search-icon" onclick="toggleSearch(this)">üîç</span>
                    <input type="text" class="search-input" onkeyup="filtrarTabla(1, this.value)" placeholder="Buscar Clave">
                </div>
            </th>
            <th>
                <div class="header-cell">
                    Nombre
                    <span class="search-icon" onclick="toggleSearch(this)">üîç</span>
                    <input type="text" class="search-input" onkeyup="filtrarTabla(2, this.value)" placeholder="Buscar Nombre">
                </div>
            </th>
            <th>
                <div class="header-cell">
                    Apellido
                    <span class="search-icon" onclick="toggleSearch(this)">üîç</span>
                    <input type="text" class="search-input" onkeyup="filtrarTabla(3, this.value)" placeholder="Buscar Apellido">
                </div>
            </th>
            <th>
                <div class="header-cell">
                    N√∫mero
                    <span class="search-icon" onclick="toggleSearch(this)">üîç</span>
                    <input type="text" class="search-input" onkeyup="filtrarTabla(4, this.value)" placeholder="Buscar N√∫mero">
                </div>
            </th>
            <th>
                <div class="header-cell">
                    Nombre Contacto
                    <span class="search-icon" onclick="toggleSearch(this)">üîç</span>
                    <input type="text" class="search-input" onkeyup="filtrarTabla(5, this.value)" placeholder="Buscar Nombre Contacto">
                </div>
            </th>
            <th>
                <div class="header-cell">
                    Nombre Cuenta
                    <span class="search-icon" onclick="toggleSearch(this)">üîç</span>
                    <input type="text" class="search-input" onkeyup="filtrarTabla(6, this.value)" placeholder="Buscar Nombre Cuenta">
                </div>
            </th>
            <th>
                <div class="header-cell">
                    Precio
                    <span class="search-icon" onclick="toggleSearch(this)">üîç</span>
                    <input type="text" class="search-input" onkeyup="filtrarTabla(7, this.value)" placeholder="Buscar Precio">
                </div>
            </th>
            <th>
                <div class="header-cell">
                    M√©todo de Pago
                    <span class="search-icon" onclick="toggleSearch(this)">üîç</span>
                    <input type="text" class="search-input" onkeyup="filtrarTabla(8, this.value)" placeholder="Buscar M√©todo de Pago">
                </div>
            </th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody id="tabla-datos">
        <!-- Los datos se llenar√°n aqu√≠ mediante JavaScript -->
    </tbody>
</table>


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    var datosOriginales = [];
        $(document).ready(function() {
            $.ajax({
                url: '../controllers/clientesActivos.php', // Aseg√∫rate de que este es el camino correcto a conexion2.php
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    datosOriginales = data;
                    mostrarDatos(datosOriginales);
                },
                error: function() {
                    alert("Error al obtener los datos");
                }
            });
        });
function mostrarDatos(data) {
    var tabla = $("#tabla-datos");
    tabla.empty(); // Limpia la tabla antes de agregar nuevos datos

    // Obtenemos los nombres de los encabezados
    var headers = [];
    $("th").each(function() {
        headers.push($(this).text());
    });

    $.each(data, function(index, row) {
        if (row !== null) {
            // Construye cada fila de la tabla
            var htmlRow = '<tr>';
            htmlRow += '<td data-label="' + headers[0] + '">' + row.correo + '</td>';
            htmlRow += '<td data-label="' + headers[1] + '">' + row.clave + '</td>';
            htmlRow += '<td data-label="' + headers[2] + '">' + row.nombre + '</td>';
            htmlRow += '<td data-label="' + headers[3] + '">' + row.apellido + '</td>';
            htmlRow += '<td data-label="' + headers[4] + '">' + row.numero + '</td>';
            htmlRow += '<td data-label="' + headers[5] + '">' + row.nombreContacto + '</td>';
            htmlRow += '<td data-label="' + headers[6] + '">' + row.nombre_cuenta + '</td>';
            htmlRow += '<td data-label="' + headers[7] + '">' + row.precio + '</td>';
            htmlRow += '<td data-label="' + headers[8] + '">' + row.metodoPago + '</td>';
            htmlRow += '<td data-label="' + headers[9] + '"><button onclick="eliminarPerfil(' + row.clienteID + ')">Eliminar</button></td>';
            htmlRow += '</tr>';

            tabla.append(htmlRow);
        }
    });
}
  function eliminarPerfil(clienteID) {
            if(confirm("¬øEst√°s seguro de que quieres eliminar este perfil?")) {
                $.ajax({
                    url: '../controllers/desactivarPerfil.php',
                    type: 'POST',
                    data: { clienteID: clienteID },
                    dataType: 'json',
                    success: function(response) {
                        if(response.success) {
                            alert(response.message);
                            location.reload(); // Recargar la p√°gina para reflejar los cambios
                        } else {
                            alert(response.message);
                        }
                    },
                    error: function() {
                        alert("Error al eliminar el perfil.");
                    }
                });
            }
        }
function aplicarFiltros() {
    var filtroNombre = $('#filtroNombre').val().toLowerCase();
    var filtroCuenta = $('#filtroCuenta').val().toLowerCase();
    var filtroMetodoPago = $('#filtroMetodoPago').val().toLowerCase();
    var filtroCorreo = $('#filtroCorreo').val().toLowerCase();

    // Verifica si todos los filtros est√°n vac√≠os
    if (!filtroNombre && !filtroCuenta && !filtroMetodoPago && !filtroCorreo) {
        mostrarDatos(datosOriginales); // Muestra todos los datos si no hay filtros aplicados
        return; // Termina la ejecuci√≥n de la funci√≥n aqu√≠
    }

    var datosFiltrados = datosOriginales.filter(function(item) {
        // Verifica si el elemento es null o no
        if (!item) return false;

        var nombre = item.nombre ? item.nombre.toLowerCase() : '';
        var nombreCuenta = item.nombre_cuenta ? item.nombre_cuenta.toLowerCase() : '';
        var metodoPago = item.metodoPago ? item.metodoPago.toLowerCase() : '';
        var correo = item.correo ? item.correo.toLowerCase() : '';

        return (nombre.includes(filtroNombre) || filtroNombre === '') &&
               (nombreCuenta.includes(filtroCuenta) || filtroCuenta === '') &&
               (metodoPago.includes(filtroMetodoPago) || filtroMetodoPago === '') &&
               (correo.includes(filtroCorreo) || filtroCorreo === '');
    });

    mostrarDatos(datosFiltrados);
}

function toggleSearch(iconElement) {
    var searchInput = iconElement.nextElementSibling;
    if (searchInput.style.display === "block") {
        searchInput.style.display = "none";
    } else {
        searchInput.style.display = "block";
        searchInput.focus();
    }
}

function filtrarTabla(colIndex, filtro) {
    filtro = filtro.toLowerCase();
    var rows = document.querySelectorAll("#tabla-datos tr");

    rows.forEach(row => {
        var cell = row.querySelectorAll("td")[colIndex];
        if (cell) {
            var textoCelda = cell.textContent.toLowerCase();
            if (textoCelda.includes(filtro)) {
                row.style.display = ""; // muestra la fila
            } else {
                row.style.display = "none"; // oculta la fila
            }
        }
    });
}

    </script>
      <script src="./script.js"></script>
</body>

</html>
